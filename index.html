<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Infinity Research Portal</title>

    <!-- === GLOBAL STYLES === -->
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #071a3d;
            font-family: Arial, Helvetica, sans-serif;
            color: #d9e6ff;
            overflow-x: hidden;
        }

        .topbar {
            width: 100%;
            background: #0d2354;
            padding: 12px 0;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 1px;
            color: #7bb9ff;
            border-bottom: 2px solid #153a83;
        }

        .container {
            padding: 20px;
            text-align: center;
        }

        /* OCTAVE BUTTONS */
        .oct-btn {
            display: block;
            width: 92%;
            margin: 14px auto;
            padding: 18px;
            background: linear-gradient(145deg,#113570,#0d244a);
            border: 2px solid #296dff;
            border-radius: 14px;
            color: #d4e6ff;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 0.5px;
            box-shadow: 0 0 12px #1e4fa8;
            transition: 0.2s ease-in-out;
        }
        .oct-btn:hover {
            background: linear-gradient(145deg,#1c4fa8,#113570);
            transform: scale(1.02);
        }

        /* Research container */
        .research-box {
            background: #0a1d42;
            margin: 18px auto;
            padding: 16px;
            width: 92%;
            border-radius: 10px;
            border: 1px solid #296dff;
            box-shadow: 0 0 8px #1a3e7f;
            text-align: left;
            font-size: 17px;
            line-height: 1.45;
            color: #cce0ff;
        }

        /* Sentence / Word / Plain toggles */
        .toggle-row {
            width: 92%;
            margin: 0 auto 18px auto;
            display: flex;
            justify-content: space-between;
        }

        .toggle-row button {
            flex: 1;
            margin: 0 4px;
            padding: 12px 0;
            background: #153a83;
            border: 1px solid #296dff;
            border-radius: 8px;
            color: #cce0ff;
            font-size: 15px;
            transition: .2s;
        }
        .toggle-row button:hover {
            background: #1f54c9;
            transform: scale(1.03);
        }

        /* Chat bubble button */
        #chat-open {
            position: fixed;
            bottom: 22px;
            right: 20px;
            width: 64px;
            height: 64px;
            background: #144aa0;
            border-radius: 50%;
            color: white;
            font-size: 32px;
            text-align: center;
            line-height: 64px;
            cursor: pointer;
            box-shadow: 0 0 12px rgba(0,0,0,0.6);
        }

        /* Hidden Chat Window */
        #chat-window {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 320px;
            height: 420px;
            background: #0e214c;
            border: 2px solid #296dff;
            border-radius: 14px;
            display: none;
            padding: 10px;
            box-shadow: 0 0 16px #1a3e7f;
        }

        #chat-log {
            width: 100%;
            height: 340px;
            background: #0b1b3e;
            border: 1px solid #1b3f91;
            border-radius: 8px;
            overflow-y: auto;
            padding: 8px;
            color: #d4e6ff;
            font-size: 14px;
        }

        #chat-input {
            width: 100%;
            margin-top: 6px;
            padding: 10px;
            background: #0b1c44;
            border: 1px solid #296dff;
            border-radius: 6px;
            color: #d4e6ff;
        }

        /* Intro modal */
        #intro-modal {
            position: fixed;
            top: 0;
            left: 0;
            width:100%;
            height:100%;
            background: rgba(0,0,0,0.78);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
        }

        #intro-card {
            background: #0d2249;
            width: 88%;
            max-width: 460px;
            padding: 24px;
            border-radius: 14px;
            border: 2px solid #296dff;
            color: #d9ecff;
            text-align: left;
            box-shadow: 0 0 18px #1a3e7f;
        }

        #intro-card h2 {
            margin-top:0;
            color:#7bb9ff;
        }

        .intro-btn {
            display:block;
            width:100%;
            margin-top:20px;
            padding:12px;
            background:#153a83;
            border-radius:10px;
            color:white;
            font-weight:bold;
            text-align:center;
        }

    </style>
</head>


<body>

<!-- Intro Modal -->
<div id="intro-modal">
    <div id="intro-card">
        <h2>Welcome to Infinity Portal</h2>
        <p>This system uses color-coded research logic: Engineer (green), CEO (orange), Import (blue), Investigate (pink), Routes (red), Data (yellow), Assimilation (purple).</p>
        <p>Your actions create tokens, build pages, grow research, and expand Infinity itself.</p>
        <label>
            <input type="checkbox" id="dont-show" />
            Donâ€™t show again
        </label>
        <div id="intro-close" class="intro-btn">Enter</div>
    </div>
</div>


<div class="topbar">âˆž Infinity Research Portal âˆž</div>

<div class="container">

    <!-- MAIN BUTTONS -->
    <div>
        <button class="oct-btn" onclick="openCategory('engineer')">Engineer (Green)</button>
        <button class="oct-btn" onclick="openCategory('ceo')">CEO (Orange)</button>
        <button class="oct-btn" onclick="openCategory('import')">Import (Blue)</button>
        <button class="oct-btn" onclick="openCategory('investigate')">Investigate (Pink)</button>
        <button class="oct-btn" onclick="openCategory('routes')">Routes (Red)</button>
        <button class="oct-btn" onclick="openCategory('data')">Data (Yellow)</button>
        <button class="oct-btn" onclick="openCategory('assimilation')">Assimilation (Purple)</button>
    </div>

    <!-- RESEARCH OUTPUT -->
    <div id="research-area" class="research-box" style="display:none;"></div>

    <!-- Toggle Buttons -->
    <div id="toggle-section" class="toggle-row" style="display:none;">
        <button onclick="setMode('sentence')">Sentence</button>
        <button onclick="setMode('word')">Word</button>
        <button onclick="setMode('plain')">Plain</button>
    </div>

</div>

<!-- CHAT BUTTON -->
<div id="chat-open">ðŸ’¬</div>

<!-- CHAT WINDOW -->
<div id="chat-window">
    <div id="chat-log"></div>
    <input id="chat-input" type="text" placeholder="Write content â†’ generate tokenâ€¦" />
</div>


<!-- LOADING APP.JS -->
<script src="app.js"></script>

</body>
<!-- === PEWPI PAT PANEL === -->
<div id="pewpi-panel"
     style="position:fixed; top:20px; left:20px; background:#0b1e45; 
            border:2px solid #296dff; border-radius:10px; padding:14px; 
            display:none; z-index:9000; width:260px;">
    <h3 style="margin-top:0; color:#7bb9ff;">Pewpi Login</h3>
    <p style="font-size:14px; color:#d4e6ff;">
        Enter your GitHub PAT once.  
        It will be <b>locally encrypted</b> and saved only on your device.
    </p>

    <input id="pewpi-input" 
           type="password"
           placeholder="Enter PATâ€¦"
           style="width:100%; padding:8px; margin-bottom:8px; 
                  background:#0a1c3f; border:1px solid #296dff; 
                  border-radius:6px; color:#cce0ff;" />

    <button onclick="savePewpiPAT()"
            style="width:100%; padding:10px; background:#153a83; color:white; 
                   border:none; border-radius:8px; font-weight:bold;">
        Save PAT
    </button>

    <button onclick="closePewpi()"
            style="width:100%; padding:10px; margin-top:6px; background:#662a2a; color:white; 
                   border:none; border-radius:8px; font-weight:bold;">
        Close
    </button>
</div>

<!-- BUTTON TO OPEN PAT PANEL -->
<div onclick="openPewpi()"
     style="position:fixed; top:20px; right:20px; padding:10px 16px; 
            background:#144aa0; color:white; border-radius:8px; 
            font-size:14px; cursor:pointer; box-shadow:0 0 8px #0a162f;">
    Pewpi
</div>


<script>
/* ================================
   INTRO MODAL CONTROL
===================================*/
window.onload = function() {
    if (localStorage.getItem("infinity_intro_hidden") === "yes") {
        document.getElementById("intro-modal").style.display = "none";
    }
};

document.getElementById("intro-close").onclick = function() {
    if (document.getElementById("dont-show").checked) {
        localStorage.setItem("infinity_intro_hidden", "yes");
    }
    document.getElementById("intro-modal").style.display = "none";
};


/* ================================
   CATEGORY OPEN HANDLER
===================================*/
function openCategory(cat) {
    document.getElementById("research-area").style.display = "block";
    document.getElementById("toggle-section").style.display = "flex";

    loadCategory(cat);
}


/* ================================
   LOAD CATEGORY RESEARCH
===================================*/
function loadCategory(cat) {
    let area = document.getElementById("research-area");

    // placeholder content until app.js loads dynamic pages
    area.innerHTML = `
        <h3 style="color:#7bb9ff; margin-top:0;">${cat.toUpperCase()}</h3>
        <p>Loading research pagesâ€¦</p>
    `;
}


/* ================================
   MODE TOGGLER
===================================*/
let currentMode = "sentence";

function setMode(m) {
    currentMode = m;
    let area = document.getElementById("research-area");
    let raw = area.dataset.rawtext || "";

    if (raw.length <= 2) return;

    renderResearch(raw);
}


/* ================================
   RENDER RESEARCH TEXT
===================================*/
let colorLogic = {
    "engineer": "#00ff7a",
    "ceo": "#ffa64d",
    "import": "#4da6ff",
    "investigate": "#ff66cc",
    "routes": "#ff4d4d",
    "data": "#ffeb3b",
    "assimilation": "#c266ff"
};

function renderResearch(text) {
    let area = document.getElementById("research-area");
    let activeColor = area.dataset.color || "#d4e6ff";

    if (currentMode === "plain") {
        area.innerHTML = `<pre>${text}</pre>`;
        return;
    }

    if (currentMode === "sentence") {
        let sentences = text.split(".");
        let html = "";

        sentences.forEach(s => {
            let trimmed = s.trim();
            if (trimmed.length === 0) return;
            html += `<p style="color:${activeColor};">${trimmed}.</p>`;
        });

        area.innerHTML = html;
        return;
    }

    if (currentMode === "word") {
        let words = text.split(" ");
        let html = "";

        words.forEach(w => {
            let cleaned = w.trim();
            if (cleaned.length === 0) return;
            html += `<span style="color:${activeColor}; margin-right:6px; cursor:pointer;">${cleaned}</span>`;
        });

        area.innerHTML = html;
        return;
    }
}


/* ================================
   CHAT BUBBLE LOGIC
===================================*/
let chatOpen = false;

document.getElementById("chat-open").onclick = function() {
    chatOpen = !chatOpen;
    document.getElementById("chat-window").style.display = chatOpen ? "block" : "none";
};

document.getElementById("chat-input").addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
        let val = this.value.trim();
        if (val.length < 1) return;
        this.value = "";
        addToChat("You: " + val);
        generateTokenFromUser(val);
    }
});

function addToChat(msg) {
    let log = document.getElementById("chat-log");
    log.innerHTML += `<div>${msg}</div>`;
    log.scrollTop = log.scrollHeight;
}


/* ================================
   PEWPI CIPHER (LOCAL ONLY)
===================================*/
function pewpiEncrypt(str) {
    let out = "";
    for (let i = 0; i < str.length; i++) {
        out += String.fromCharCode(str.charCodeAt(i) + 7);
    }
    return btoa(out);
}

function pewpiDecrypt(str) {
    try {
        let decoded = atob(str);
        let out = "";
        for (let i = 0; i < decoded.length; i++) {
            out += String.fromCharCode(decoded.charCodeAt(i) - 7);
        }
        return out;
    } catch {
        return "";
    }
}

function openPewpi() {
    document.getElementById("pewpi-panel").style.display = "block";
}

function closePewpi() {
    document.getElementById("pewpi-panel").style.display = "none";
}

function savePewpiPAT() {
    let raw = document.getElementById("pewpi-input").value.trim();
    if (raw.length < 5) return alert("Invalid PAT.");

    let encrypted = pewpiEncrypt(raw);
    localStorage.setItem("pewpi_pat", encrypted);

    alert("PAT saved securely through Pewpi.");
    closePewpi();
}


/* ================================
   GITHUB WRITE (CALLS APP.JS)
===================================*/
function generateTokenFromUser(raw) {
    if (typeof generateToken === "function") {
        generateToken(raw);
    } else {
        addToChat("System: app.js not yet loaded.");
    }
}

</script>

</body>
</html>
